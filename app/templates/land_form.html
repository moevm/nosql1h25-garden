{% extends "base.html" %}

{% block title %}Огородник — {% if is_edit %}Редактировать участок{% else %}Новый участок{% endif %}{% endblock %}

{% block content %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/land_style.css') }}"> 
<div class="container land-form-container">
    <h2>{% if is_edit %}Редактировать участок{% else %}Создать новый участок{% endif %}</h2>

    <!-- Flash messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        <div class="flash-messages">
          {% for category, message in messages %}
            <div class="alert alert-{{ category }}">{{ message }}</div>
          {% endfor %}
        </div>
      {% endif %}
    {% endwith %}

    <form method="POST" action="{{ url_for('land_bp.edit_garden', garden_id=garden_id) if is_edit else url_for('land_bp.new_garden') }}" enctype="multipart/form-data">
        <div class="form-group">
            <label for="name">Название участка <span class="required">*</span></label>
            <input type="text" id="name" name="name" value="{{ form_data.name if form_data and form_data.name is defined else '' }}" required>
        </div>

        <div class="form-group">
            <label for="location">Местоположение</label>
            <input type="text" id="location" name="location" value="{{ form_data.location if form_data and form_data.location is defined else '' }}">
        </div>

        <div class="form-group">
            <label for="area">Площадь (кв. м)</label>
            <input type="number" step="0.01" id="area" name="area" value="{{ form_data.area if form_data and form_data.area is defined else '' }}">
        </div>

        <div class="form-group">
            <label for="soil_type">Тип почвы</label>
            <select id="soil_type" name="soil_type" class="form-control">
                {% for type_choice in soil_types %}
                    <option value="{{ type_choice }}" {% if form_data and form_data.soil_type == type_choice %}selected{% endif %}>{{ type_choice if type_choice else "-- Выберите --" }}</option>
                {% endfor %}
            </select>
        </div>

        <div class="form-group">
            <label for="terrain_type">Тип местности</label>
            <select id="terrain_type" name="terrain_type" class="form-control">
                {% for type_choice in terrain_types %}
                    <option value="{{ type_choice }}" {% if form_data and form_data.terrain_type == type_choice %}selected{% endif %}>{{ type_choice if type_choice else "-- Выберите --" }}</option>
                {% endfor %}
            </select>
        </div>

        <div class="form-group">
            <label for="lighting">Освещенность</label>
            <select id="lighting" name="lighting" class="form-control">
                {% for option_choice in lighting_options %}
                    <option value="{{ option_choice }}" {% if form_data and form_data.lighting == option_choice %}selected{% endif %}>{{ option_choice if option_choice else "-- Выберите --" }}</option>
                {% endfor %}
            </select>
        </div>

        <div class="form-group">
            <label for="photo">Фотография участка</label>
            <input type="file" id="photo" name="photo" accept="image/png, image/jpeg, image/gif">
            {% if is_edit and form_data.photo_file_paths and form_data.photo_file_paths[0] %}
                <p><small>Текущее фото: <img src="{{ url_for('static', filename=form_data.photo_file_paths[0]) }}" alt="Current photo" style="max-width: 100px; max-height: 100px; margin-top: 5px;"></small><br>
                <small>Загрузка нового файла заменит текущее фото.</small></p>
            {% endif %}
        </div>
        
        <div class="form-actions">
            <button type="submit" class="btn btn-primary">{% if is_edit %}Сохранить изменения{% else %}Создать участок{% endif %}</button>
            <a href="{{ url_for('land_bp.gardens') }}" class="btn btn-secondary">Отмена</a>
        </div>
    </form>
</div>
{% endblock %} 